<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="~{fragments/header.html :: fragment-header}"></div>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/profileEdit.css}">
</head>
<body class="profile-edit-body">
    <div th:insert="~{fragments/nav.html :: fragment-nav}"></div>

    <div class="profile-edit-container">
        <div class="profile-edit-card">
            <!-- Header Section -->
            <div class="profile-edit-header">
                <h1 class="profile-edit-title">
                    <i class="fas fa-user-edit icon"></i>
                    프로필 수정
                </h1>
            </div>

            <!-- Form Content -->
            <div class="profile-edit-body-content">
                <form id="profileForm">
                    <!-- 기본 정보 섹션 -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-user"></i>
                            기본 정보
                        </h3>

                        <div class="form-group-row">
                            <div class="form-group">
                                <label class="form-label" for="name">이름</label>
                                <input type="text" id="name" class="form-control" th:value="${member.name}" placeholder="이름을 입력하세요" />
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="nickname">별명</label>
                                <input type="text" id="nickname" class="form-control" th:value="${member.nickname}" placeholder="별명을 입력하세요" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="password">비밀번호</label>
                            <input type="password" id="password" class="form-control" th:value="${member.password}" placeholder="새 비밀번호를 입력하세요" />
                        </div>
                    </div>

                    <!-- 연락처 정보 섹션 -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-address-book"></i>
                            연락처 정보
                        </h3>

                        <div class="form-group">
                            <label class="form-label" for="email">이메일</label>
                            <input type="email" id="email" class="form-control" th:value="${member.email}" placeholder="이메일을 입력하세요" />
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="phoneNumber">핸드폰 번호</label>
                            <input type="tel" id="phoneNumber" class="form-control" th:value="${member.phoneNumber}" placeholder="핸드폰 번호를 입력하세요" />
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="address">주소</label>
                            <input type="text" id="address" class="form-control" th:value="${member.address}" placeholder="주소를 입력하세요" />
                        </div>
                    </div>

                    <!-- 추가 정보 섹션 -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-info-circle"></i>
                            추가 정보
                        </h3>

                        <div class="form-group">
                            <label class="form-label" for="introduction">자기 소개</label>
                            <textarea id="introduction" class="form-control textarea-control" th:text="${member.introduction}" placeholder="자기소개를 입력하세요"></textarea>
                        </div>
                    </div>

                    <!-- 동의 체크박스 -->
                    <div class="checkbox-container">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox">
                                <input type="checkbox" id="agreeUpdate" checked />
                                <span class="checkmark"></span>
                            </div>
                            <label class="checkbox-label" for="agreeUpdate">
                                프로필 수정에 동의합니다
                            </label>
                        </div>
                    </div>

                    <!-- 제출 버튼 -->
                    <div class="submit-section">
                        <button type="submit" class="submit-button">
                            <i class="fas fa-save"></i>
                            프로필 업데이트
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('profileForm');
            const submitButton = form.querySelector('.submit-button');
            const agreeCheckbox = document.getElementById('agreeUpdate');

            // Form validation
            function validateForm() {
                const requiredFields = ['name', 'nickname', 'email'];
                let isValid = true;

                requiredFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    const value = field.value.trim();

                    if (!value) {
                        field.classList.add('error');
                        field.classList.remove('success');
                        isValid = false;
                    } else {
                        field.classList.remove('error');
                        field.classList.add('success');
                    }
                });

                // Email validation
                const email = document.getElementById('email');
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (email.value && !emailRegex.test(email.value)) {
                    email.classList.add('error');
                    email.classList.remove('success');
                    isValid = false;
                }

                return isValid && agreeCheckbox.checked;
            }

            // Submit button state management
            function updateSubmitButton() {
                if (validateForm()) {
                    submitButton.disabled = false;
                    submitButton.style.opacity = '1';
                } else {
                    submitButton.disabled = true;
                    submitButton.style.opacity = '0.6';
                }
            }

            // Real-time validation
            const inputs = form.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', updateSubmitButton);
                input.addEventListener('blur', updateSubmitButton);
            });

            agreeCheckbox.addEventListener('change', updateSubmitButton);

            // Form submission
            form.addEventListener('submit', function(event) {
                event.preventDefault();

                if (!validateForm()) {
                    alert('필수 필드를 모두 올바르게 입력하고 동의사항을 확인해주세요.');
                    return;
                }

                // Loading state
                submitButton.classList.add('loading');
                submitButton.disabled = true;

                const formData = {
                    name: document.getElementById('name').value.trim(),
                    nickname: document.getElementById('nickname').value.trim(),
                    password: document.getElementById('password').value,
                    address: document.getElementById('address').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    phoneNumber: document.getElementById('phoneNumber').value.trim(),
                    introduction: document.getElementById('introduction').value.trim(),
                };

                fetch('/mypage/profileEdit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('서버 오류: ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    // Success animation
                    submitButton.innerHTML = '<i class="fas fa-check"></i> 완료!';
                    submitButton.style.background = '#28a745';

                    setTimeout(() => {
                        alert('프로필이 성공적으로 업데이트되었습니다.');
                        window.location.href = '/mypage';
                    }, 1000);
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('프로필 업데이트 중 오류가 발생했습니다. 다시 시도해주세요.');

                    // Reset button state
                    submitButton.classList.remove('loading');
                    submitButton.disabled = false;
                });
            });

            // Initial validation
            updateSubmitButton();
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
            crossorigin="anonymous"></script>
</body>
</html>